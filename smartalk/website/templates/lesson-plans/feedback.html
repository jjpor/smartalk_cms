{# --- Fase 1: Intestazione (Variabili Semplici & Navigazione) --- #}
{% set lesson_title = "The Art of Feedback: Giving and Receiving" %}
{% set lesson_subtitle = "To tell you off, the nice way (and to respond gracefully when you're told off)." %}

{# CRITICO: nav_links su UNA SOLA RIGA per sicurezza parser backend #}
{% set nav_links = [{'id': 'giving', 'title': 'Giving Decalogue'}, {'id': 'sandwich', 'title': 'Sandwich Technique'}, {'id': 'receiving', 'title': 'Receiving Decalogue'}, {'id': 'quiz', 'title': 'Scenario Quiz'}] %}


{# --- Fase 2: Estensione e Import --- #}
{% extends "abstract_templates/lesson_base.html" %}
{% from "abstract_templates/_macros.html" import info_card, match_exercise, multiple_choice_exercise %}


{# --- Fase 3: Blocco Contenuto --- #}
{% block lesson_content %}

{# --- Fase 4: Dati Esercizi (Definiti INTERNAMENTE per sicurezza) --- #}

{# Dati per Sezione 2 (Sandwich Match) #}
{% set sandwich_terms = [
    {'id': '1', 'text': 'Top Bun (Positive Opening)'},
    {'id': '2', 'text': 'The Meat (Specific Observation)'},
    {'id': '3', 'text': 'The Action (Suggestion)'},
    {'id': '4', 'text': 'Bottom Bun (Positive Closing)'}
] %}
{% set sandwich_examples = [
    {'id': '1', 'text': 'Your presentation visuals were stunning and very clear.'},
    {'id': '2', 'text': 'However, you rushed the Q&A section, leaving some people confused.'},
    {'id': '3', 'text': 'Next time, please reserve 5 minutes just for questions.'},
    {'id': '4', 'text': 'Overall, it was a huge success. Thanks for your hard work!'}
] %}

{# Dati per Sezione 4 (Scenario Quiz) #}
{% set scenario_quiz = [
    {
        'text': 'Scenario: Your manager says "You were disorganized this year." (Vague feedback)',
        'options': [
            {'value': 'a', 'text': 'Defend yourself immediately with a list of organized projects.'},
            {'value': 'b', 'text': 'Ask for clarity: "Can you give me a specific example of when I was disorganized?"'},
            {'value': 'c', 'text': 'Nod silently and ignore it.'}
        ],
        'correct_value': 'b'
    },
    {
        'text': 'Scenario: A coworker says "You interrupt people in meetings too often."',
        'options': [
            {'value': 'a', 'text': 'Say: "I only interrupt when they are wrong."'},
            {'value': 'b', 'text': 'Say: "Thanks for telling me. I didn\'t realize I was doing that. I\'ll watch out for it."'},
            {'value': 'c', 'text': 'Say: "Well, you are too quiet in meetings."'}
        ],
        'correct_value': 'b'
    },
    {
        'text': 'Scenario: A client says your deliverables are "too abstract".',
        'options': [
            {'value': 'a', 'text': 'Apologize profusely and promise to redo everything today.'},
            {'value': 'b', 'text': 'Explain that they didn\'t provide enough data to be specific.'},
            {'value': 'c', 'text': 'Empathize and Ask: "I understand. What specific details would make this more actionable for you?"'}
        ],
        'correct_value': 'c'
    }
] %}


{# --- Fase 5: Conversione Contenuto --- #}

{% call info_card('giving', '1. Giving Feedback: The Decalogue', initial_state='show') %}
    <div class="mt-4 text-slate-700">
        <h4 class="font-bold text-sky-800 mb-4">Ten Rules for Effective, Constructive Feedback</h4>
        <ul class="ml-4 space-y-2">
            <li><span class="font-bold">1. Be Specific and Timely:</span> Give clear examples promptly after the event.</li>
            <li><span class="font-bold">2. Focus on Behavior, Not Personality:</span> Address actions, not inherent traits.</li>
            <li><span class="font-bold">3. Balance Positivity and Constructiveness:</span> Highlight strengths and areas for growth.</li>
            <li><span class="font-bold">4. Use the "Sandwich" Technique:</span> Start and end positively, with constructive feedback in between.</li>
            <li><span class="font-bold">5. Be Objective and Empathetic:</span> Base feedback on facts, considering the person's feelings.</li>
            <li><span class="font-bold">6. Encourage Dialogue:</span> Foster open communication and offer solutions.</li>
            <li><span class="font-bold">7. Follow Up:</span> Check progress and demonstrate your own receptiveness to feedback.</li>
            <li><span class="font-bold">8. Maintain Respect:</span> Deliver feedback courteously, regardless of the topic.</li>
            <li><span class="font-bold">9. Tailor to the Individual:</span> Customize your approach to suit different learning styles.</li>
            <li><span class="font-bold">10. Promote Growth:</span> Highlight that feedback is a tool for improvement, not punishment.</li>
        </ul>
    </div>
{% endcall %}

<hr class="my-12 border-gray-200">

{% call info_card('sandwich', '2. Practice: The Sandwich Technique', initial_state='show') %}
    <div class="mt-4">
        <p class="mb-6 text-slate-600">The "Feedback Sandwich" is a classic technique. Match the parts of the sandwich to the correct example phrase.</p>
        {{ match_exercise('sandwich-match', sandwich_terms, sandwich_examples) }}
    </div>
{% endcall %}

<hr class="my-12 border-gray-200">

{% call info_card('receiving', '3. Receiving Feedback: The Decalogue', initial_state='show') %}
    <div class="mt-4 text-slate-700">
        <h4 class="font-bold text-purple-800 mb-4">Ten Rules for Turning Criticism into Growth</h4>
        <ul class="ml-4 space-y-2">
            <li><span class="font-bold">1. Listen Attentively:</span> Pay close attention without planning your rebuttal.</li>
            <li><span class="font-bold">2. Remain Calm:</span> Stay composed and maintain an open-minded posture.</li>
            <li><span class="font-bold">3. Seek Clarity:</span> Ask for specific examples to ensure you understand.</li>
            <li><span class="font-bold">4. Avoid Defensiveness:</span> Refrain from justifying your actions immediately.</li>
            <li><span class="font-bold">5. Express Gratitude:</span> Thank the giver for their input, even if it's hard to hear.</li>
            <li><span class="font-bold">6. Reflect:</span> Take time to digest before acting.</li>
            <li><span class="font-bold">7. Find Value:</span> Look for the insights and legitimate areas for improvement.</li>
            <li><span class="font-bold">8. Take Action:</span> Identify steps for improvement.</li>
            <li><span class="font-bold">9. Follow Up:</span> Close the feedback loop by sharing your progress.</li>
            <li><span class="font-bold">10. Continuous Growth:</span> Frame feedback as an indispensable tool for development.</li>
        </ul>

        <div class="mt-8 p-4 bg-slate-50 rounded-lg border-l-4 border-purple-500">
            <h4 class="font-bold text-slate-800 mb-2">Key Scripts for Receiving</h4>
            <ul class="ml-6 list-disc space-y-2 text-slate-700">
                <li><strong>Acknowledge:</strong> "Thank you for taking the time to tell me this. I'm listening."</li>
                <li><strong>Seek Clarity:</strong> "I hear what you're saying. Could you give me a specific example of when I did that?"</li>
                <li><strong>Action Plan:</strong> "I'll reflect on this, and I plan to start [action] next week. I'll follow up then."</li>
            </ul>
        </div>
    </div>
{% endcall %}

<hr class="my-12 border-gray-200">

{% call info_card('quiz', '4. Roleplay: Receiving Feedback Quiz', initial_state='show') %}
    <div class="mt-4">
        <p class="mb-6 text-slate-600">What is the BEST immediate reaction in these tough situations?</p>
        {{ multiple_choice_exercise('receiving-quiz', scenario_quiz) }}
    </div>
{% endcall %}

{% endblock lesson_content %}