{% extends "base.html" %}

{% block title %}
    {{ lesson_title }} - Smartalk Lesson Plan
{% endblock %}

{% block content %}
    <div class="container mx-auto p-4 md:p-8 max-w-4xl pt-24">
        <header class="text-center mb-12">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900 font-montserrat">{{ lesson_title }}</h1>
            <p class="text-lg text-slate-600 mt-2">{{ lesson_subtitle }}</p>
        </header>

        <nav class="mb-8 sticky top-20 bg-white/80 backdrop-blur-sm z-10 py-2">
            <ul class="flex justify-center flex-wrap gap-x-4 gap-y-2">
                {% for nav_item in nav_links %}
                    <li><a href="#{{ nav_item.id }}" class="section-nav-link py-2 px-3 text-sm md:text-base text-slate-500 hover:text-slate-700 rounded-lg">{{ nav_item.title }}</a></li>
                {% endfor %}
            </ul>
        </nav>
        
        <main>
            <div class="lesson-content space-y-12">
                {% block lesson_body %}{% endblock %}
            </div>
        </main>
    </div>
{% endblock content %}

{% block extra_scripts %}
    {{ super() }} 
    
    <script src="/static/content.js"></script>
    
    <script>
        // Logica di base per il collapsible cards, estratta dai tuoi file
        function setupCollapsibleCards() {
            const cardHeaders = document.querySelectorAll('.card-header');
            cardHeaders.forEach(header => {
                header.addEventListener('click', () => {
                    const content = header.nextElementSibling;
                    if (content && content.classList.contains('card-content')) {
                        content.classList.toggle('show');
                        
                        const arrowIcon = header.querySelector('.arrow-icon');
                        if (arrowIcon) {
                            if (content.classList.contains('show')) {
                                arrowIcon.style.transform = 'rotate(180deg)';
                            } else {
                                arrowIcon.style.transform = 'rotate(0deg)';
                            }
                        }
                    }
                });
            });
        }

        // Logica per lo smooth scrolling della nav interna
        function setupNavigation() {
            const navLinks = document.querySelectorAll('.section-nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    // Assicurati che lo scroll avvenga sopra l'header sticky
                    document.querySelector(e.target.getAttribute('href')).scrollIntoView({ behavior: 'smooth', block: 'start' });
                });
            });
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            setupCollapsibleCards();
            setupNavigation();
        });
    </script>
{% endblock extra_scripts %}
